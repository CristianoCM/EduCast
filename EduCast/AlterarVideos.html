<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" type="text/css" href="AlterarVideos.css">

	<meta charset="utf-8">
	<title>Alteração de Vídeos - Interno</title>
</head>
<body>

	<div class="container">
		<br>
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12">
				<h1>- Alteração de Vídeos</h1>
				<hr>
				(!) Informe pelo menos um filtro para alterar um determinado vídeo
			</div>
		</div>
		<br>
		<h4>Filtros:</h4>
		<div class="row">
			<div class="col-lg-4 col-md-4 col-sm-4">
				<div class="form-group">
	              <label for="inputCodigo"><span style="font-size: 24px; font-weight: bold;">Código do Vídeo desejado:</span></label>
	              <input class="form-control input-sm" id="inputCodigo" type="text" placeholder="Código" maxlength="15">
	            </div>
			</div>
			<!--<div class="col-lg-5 col-md-5 col-sm-5">
				<div class="form-group">
	              <label for="inputFtitulo"><span style="font-size: 24px; font-weight: bold;">Título do Vídeo desejado:</span></label>
	              <input class="form-control input-sm" id="inputFtitulo" type="text" placeholder="Título" maxlength="15">
	            </div>
			</div>-->
		</div>
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12">
				<button type="button" class="btn btn-info btn-lg" data-toggle="modal" onclick="carregarDados()">Carregar Dados</button>
			</div>
		</div>
	</div>
	<div class="container" id="dados">
		<br>
		<hr>
		<br>
		<div class="row">
			<div class="col-lg-9 col-md-9 col-sm-9">
				<div class="form-group">
	              <label for="inputTitulo"><span style="font-size: 24px; font-weight: bold;">1. Título:</span></label>
	              <input class="form-control input-sm" id="inputTitulo" type="text" placeholder="Título" maxlength="80">
	            </div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-9 col-md-9 col-sm-9">
				<div class="form-group">
	              <label for="inputCaminhoV"><span style="font-size: 24px; font-weight: bold;">2. Caminho do Vídeo no Servidor:</span></label>
	              <input class="form-control input-sm" id="inputCaminhoV" type="text" placeholder="Caminho do Vídeo" maxlength="120" value="Videos/">
	            </div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-9 col-md-9 col-sm-9">
				<div class="form-group">
	              <label for="inputCaminhoM"><span style="font-size: 24px; font-weight: bold;">3. Caminho da Miniatura do Vídeo no Servidor:</span></label>
	              <input class="form-control input-sm" id="inputCaminhoM" type="text" placeholder="Caminho da Miniatura" maxlength="120" value="Imagens/">
	            </div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-3 col-md-3 col-sm-3">
				<div class="form-group">
	              <label for="inputFormato"><span style="font-size: 24px; font-weight: bold;">4.1. Formato:</span></label>
	              <select class="custom-select" id="inputFormato">
			        <option value="1">MP4</option>
			        <option value="2">MKV</option>
			        <option value="3">AVI</option>
			      </select>
	            </div>
			</div>
			<div class="col-lg-3 col-md-3 col-sm-3">
				<div class="form-group">
	              <label for="inputTamanho"><span style="font-size: 24px; font-weight: bold;">4.2. Tamanho (Peso):</span></label>
	              <input class="form-control input-sm" id="inputTamanho" type="text" placeholder="Tamanho (Peso)" maxlength="5" style="width: 80%; float: left;"><input class="form-control input-sm" id="inputTamanhoUnidade" type="text" disabled value="MB" style="width: 20%;" >
	            </div>
			</div>
			<div class="col-lg-3 col-md-3 col-sm-3">
				<div class="form-group">
	              <label for="inputDuracao"><span style="font-size: 24px; font-weight: bold;">4.3. Duração:</span></label>
	              <input class="form-control input-sm" id="inputDuracao" type="time" style="font-size: 18px;">
	            </div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-9 col-md-9 col-sm-9">
				<div class="form-group">
	              <label for="inputDescricao"><span style="font-size: 24px; font-weight: bold;">5. Descrição:</span></label>
	              <textarea class="form-control input-sm" id="inputDescricao" name="txtDescricao" rows="5" placeholder="Descrição..." style="resize: none;" maxlength="255"></textarea>
	            </div>
			</div>
		</div>
		<hr>
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12">
				<button type="button" class="btn btn-success btn-lg" data-toggle="modal" onclick="verificarDados()">Atualizar Vídeo</button>
				<button type="button" class="btn btn-warning btn-lg" data-toggle="modal" onclick="limparDados()">Limpar Formulário</button>
			</div>
		</div>
	</div>

	<!-- MODALS -->
	<div class="modal fade" id="modalDadosNotFound" tabindex="-1" role="dialog" aria-labelledby="modalDadosNotFoundTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="modalDadosNotFoundLongTitle">Falha</h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					Vídeo indicado <strong>não foi encontrado</strong>.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modalVazio" tabindex="-1" role="dialog" aria-labelledby="modalVazioTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="modalVazioLongTitle">Aviso</h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<span id="mVazTi" style="color: #33cccc;"></span> não pode ficar vazio.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modalDadosNaoAtualizados" tabindex="-1" role="dialog" aria-labelledby="modalDadosNaoAtualizadosTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="modalDadosNaoAtualizadosLongTitle">Falha</h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					Informações do Vídeo indicado <strong>não puderam ser atualizadas</strong>. Erro inesperado.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modalDadosAtualizados" tabindex="-1" role="dialog" aria-labelledby="modalDadosAtualizadosTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="modalDadosAtualizadosLongTitle">Sucesso</h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					Informações do Vídeo indicado <strong>foram atualizadas com sucesso</strong>!
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-success" data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		
		function verificarDados() {
			var titulo = $("#inputTitulo").val();
			var caminhoVideo = $("#inputCaminhoV").val();
			var caminhoMiniatura = $("#inputCaminhoM").val();
			var formato = $("#inputFormato option:selected").html();
			var tamanho = $("#inputTamanho").val();
			var duracao = $("#inputDuracao").val();
			var descricao = $("#inputDescricao").val();
			var codigo = $("#inputCodigo").val();
			var tituloF = $("#inputFtitulo").val();

			if (titulo.length == 0) {
				$("#inputTitulo").css("border-color", "red");
				$("#mVazTi").val("Título");
				$('#modalVazio').modal('show');
				return;
	        } else if (caminhoVideo.length == 0) {
				$("#caminhoVideo").css("border-color", "red");
				$("#mVazTi").val("Caminho do Vídeo");
				$('#modalVazio').modal('show');
				return;
	        } else if (caminhoMiniatura.length == 0) {
				$("#inputCaminhoM").css("border-color", "red");
				$("#mVazTi").val("Caminho da Miniatura");
				$('#modalVazio').modal('show');
				return;
	        } else if (tamanho.length == 0) {
				$("#inputTamanho").css("border-color", "red");
				$("#mVazTi").val("Tamanho (Peso)");
				$('#modalVazio').modal('show');
				return;
	        } else if (duracao.length == 0) {
				$("#inputDuracao").css("border-color", "red");
				$("#mVazTi").val("Duração");
				$('#modalVazio').modal('show');
				return;
	        } else if (descricao.length == 0) {
				$("#inputDescricao").css("border-color", "red");
				$("#mVazTi").val("Descrição");
				$('#modalVazio').modal('show');
				return;
	        }

	        $.ajax({
				type: "POST",
				url: 'Database/atualizar_video.php',
				data: {titulo: titulo, caminhoVideo: caminhoVideo, caminhoMiniatura: caminhoMiniatura,
					formato: formato, tamanho: tamanho, duracao: duracao,
					descricao: descricao, codigo: codigo, tituloF: tituloF},
				success: function(result) {
					var vRes = result.split("|");
					var tRes = vRes.length;
					var stat = vRes[tRes - 1];

					if (stat == "OK") {
						$('#dados').hide();
						limparDados();
						$('#modalDadosAtualizados').modal('show');
					} else {
						$('#modalDadosNaoAtualizados').modal('show');
					}
				}
			});
		}

		function limparDados() {
			$("#inputTitulo").val("");
			$("#inputCaminhoV").val("Videos/");
			$("#inputCaminhoM").val("Imagens/");
			$("#inputFormato").val("1");
			$("#inputTamanho").val("");
			$("#inputDuracao").val("");
			$("#inputDescricao").val("");
		}

		function carregarDados() {
			//var titulo = $('#inputFtitulo').val();
			var codigo = $('#inputCodigo').val();
			$.ajax({
				type: "POST",
				url: 'Database/get_video_info.php',
				data: {codigo, codigo},
				success: function(result) {
					var vRes = result.split("html>")[3].split("¬");
					var tRes = vRes.length;
					var stat = vRes[tRes - 1];

					if (stat != "NOPS") {
						$('#dados').hide();
						$("#inputTitulo").val(vRes[1]);
						$("#inputCaminhoV").val(vRes[3]);
						$("#inputCaminhoM").val(vRes[7]);
						$("#inputFormato option:selected").val(vRes[4] == "MP4" ? "1" : vRes[4] == "MKV" ? "2" : "3");
						$("#inputTamanho").val(vRes[5]);
						$("#inputDuracao").val(vRes[6]);
						$("#inputDescricao").val(vRes[2]);
						if ($("#inputCaminhoV").val() == "")
							$('#modalDadosNotFound').modal('show');
						else
							$('#dados').show();
					} else {
						$('#dados').hide();
						limparDados();
						$('#modalDadosNotFound').modal('show');
					}
				}
			});
		}

	</script>

</body>
</html>
