<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" type="text/css" href="Busca.css">

  <meta charset="utf-8">
  <title>EduCast - Busca</title>
</head>
<body>

	<nav class="navbar navbar-expand-lg navbar-expand-md navbar-light bg-light">
	  <a class="navbar-brand">
	    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmqfbrxTA2rPM4c4WBE5dNth3ovxw2YbMrFXG5S4rFznAaJwkY" width="30" height="30" class="d-inline-block align-top" alt="">
	    Edu<span style="color: #33cccc;">Cast</span>
	  </a>
	  <div class="collapse navbar-collapse" id="navbarText">
	    <ul class="navbar-nav mr-auto">
	      <li class="nav-item">
	        <a class="nav-link" href="Biblioteca.html">Acervo</a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link" href="#">Perfil</a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link" href="Login.html">Sair</a>
	      </li>
	    </ul>
	  </div>
	  <form class="form-inline">
	  	<div class="container">
	  		<div class="row">
	  			<div class="col-lg-12 col-md-12 col-sm-12">
	  				<div class="input-group">
				  		<div class="input-group-btn search-panel">
						  	<button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
					        	<span id="search_concept">Conteúdo</span> <span class="caret"></span>
					        </button>
					        <ul class="dropdown-menu" role="menu">
					          <li><a href="#">Programação</a></li>
					          <li><a href="#">Redes</a></li>
					          <li><a href="#">Mobile</a></li>
					          <li><a href="#">Banco de Dados</a></li>
					          <li><a href="#">Hardware</a></li>
					          <li><hr style="margin-top: 5px; margin-bottom: 5px;"></li>
					          <li><a href="#">Todos</a></li>
					        </ul>
				    	</div>
				        <input class="form-control botao-buscar" type="search" placeholder="Buscar pelo título..." id="txtPesquisa">
					    <button class="btn btn-outline-info fa fa-search" type="submit" title="Buscar" onclick="return buscar()"></button>
					</div>
	  			</div>
	  		</div>
	  	</div>
	  </form>
	</nav>

	<br>

	<div class="container-fluid">
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12 text-center">
				<h2>Resultado da <span style="color: #33cccc;">Pesquisa</span>:</h2>
				<p id="txtPesquisado" style="font-family: Palatino Linotype, Book Antiqua, Palatino, serif;"></p>
			</div>			
		</div>

		<div class="row">
        	<div class="col-lg-5 col-md-4 col-sm-4"></div>
            <div class="col-lg-2 col-md-4 col-sm-4 busca-setas">
            	<a class="btn btn-outline-secondary prev seta-esquerda-pop" title="Itens Anteriores" id="busca_prev">
            		<i class="fa fa-lg fa-chevron-left"></i>
            	</a>
            	<a class="btn btn-outline-secondary next seta-direita-pop" title="Itens Posteriores" id="busca_next">
            		<i class="fa fa-lg fa-chevron-right"></i>
            	</a>
            </div>
            <div class="col-lg-5 col-md-4 col-sm-4"></div>
        </div>
        <br>

	</div>

	<section class="carousel slide" data-ride="carousel" id="busca">
		
		<div class="container-fluid">
			<div class="row">
				<div class="col-lg-1 col-md-1 col-sm-1"></div>

				<div class="col-lg-2 col-md-4 col-sm-4">
					<div class="card text-white mb-3" style="max-width: 18rem;">
					  <div class="card-header" id="busca_titulo1">Título</div>
					  <div class="card-body">
					  	<div class="video" id="busca_video1">
					  		<a href="Exibicao.html">
							  	<video loop muted preload="none" poster="Imagens/EduCast Background.jpg">
							      <source src="Videos/main-background.mp4" type="video/mp4">
							      Your browser does not support the video tag.
							    </video>
						    </a>
						</div>
						<div class="video-info">
							<span class="badge badge-pill badge-light" id="busca_duracao1"><span style="color: #3399ff;">Duração:</span> 3:12</span>
							<span class="badge badge-pill badge-light" id="busca_autor1"><span style="color: #3399ff;">Autor:</span> Carlos Roberto</span>
						</div>
						<div id="busca_tags1">
							<span class="badge badge-pill badge-dark">C#</span>
					    	<span class="badge badge-pill badge-dark">ASP.NET</span>
					    	<span class="badge badge-pill badge-dark">MVC</span>
					    	<span class="badge badge-pill badge-dark">Visual Studio</span>
						</div>
					  </div>
					  <div class="card-footer">
					    <p class="card-text" id="busca_descricao1">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
					  </div>
					</div>
				</div>

				<div class="col-lg-2 col-md-4 col-sm-4">
					<div class="card text-white mb-3" style="max-width: 18rem;">
					  <div class="card-header" id="busca_titulo2">Título</div>
					  <div class="card-body">
					  	<div class="video" id="busca_video2">
					  		<a href="Exibicao.html">
							  	<video loop muted preload="none" poster="Imagens/EduCast Background.jpg">
							      <source src="Videos/main-background.mp4" type="video/mp4">
							      Your browser does not support the video tag.
							    </video>
						    </a>
						</div>
						<div class="video-info">
							<span class="badge badge-pill badge-light" id="busca_duracao2"><span style="color: #3399ff;">Duração:</span> 3:12</span>
							<span class="badge badge-pill badge-light" id="busca_autor2"><span style="color: #3399ff;">Autor:</span> Carlos Roberto</span>
						</div>
						<div id="busca_tags2">
							<span class="badge badge-pill badge-dark">C#</span>
					    	<span class="badge badge-pill badge-dark">ASP.NET</span>
					    	<span class="badge badge-pill badge-dark">MVC</span>
					    	<span class="badge badge-pill badge-dark">Visual Studio</span>
						</div>
					  </div>
					  <div class="card-footer">
					    <p class="card-text" id="busca_descricao2">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
					  </div>
					</div>
				</div>

				<div class="col-lg-2 col-md-4 col-sm-4">
					<div class="card text-white mb-3" style="max-width: 18rem;">
					  <div class="card-header" id="busca_titulo3">Título</div>
					  <div class="card-body">
					  	<div class="video" id="busca_video3">
					  		<a href="Exibicao.html">
							  	<video loop muted preload="none" poster="Imagens/EduCast Background.jpg">
							      <source src="Videos/main-background.mp4" type="video/mp4">
							      Your browser does not support the video tag.
							    </video>
						    </a>
						</div>
						<div class="video-info">
							<span class="badge badge-pill badge-light" id="busca_duracao3"><span style="color: #3399ff;">Duração:</span> 3:12</span>
							<span class="badge badge-pill badge-light" id="busca_autor3"><span style="color: #3399ff;">Autor:</span> Carlos Roberto</span>
						</div>
						<div id="busca_tags3">
							<span class="badge badge-pill badge-dark">C#</span>
					    	<span class="badge badge-pill badge-dark">ASP.NET</span>
					    	<span class="badge badge-pill badge-dark">MVC</span>
					    	<span class="badge badge-pill badge-dark">Visual Studio</span>
						</div>
					  </div>
					  <div class="card-footer">
					    <p class="card-text" id="busca_descricao3">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
					  </div>
					</div>
				</div>

				<div class="col-lg-2 col-md-4 col-sm-4">
					<div class="card text-white mb-3" style="max-width: 18rem;">
					  <div class="card-header" id="busca_titulo4">Título</div>
					  <div class="card-body">
					  	<div class="video" id="busca_video4">
					  		<a href="Exibicao.html">
							  	<video loop muted preload="none" poster="Imagens/EduCast Background.jpg">
							      <source src="Videos/main-background.mp4" type="video/mp4">
							      Your browser does not support the video tag.
							    </video>
						    </a>
						</div>
						<div class="video-info">
							<span class="badge badge-pill badge-light" id="busca_duracao4"><span style="color: #3399ff;">Duração:</span> 3:12</span>
							<span class="badge badge-pill badge-light" id="busca_autor4"><span style="color: #3399ff;">Autor:</span> Carlos Roberto</span>
						</div>
						<div id="busca_tags4">
							<span class="badge badge-pill badge-dark">C#</span>
					    	<span class="badge badge-pill badge-dark">ASP.NET</span>
					    	<span class="badge badge-pill badge-dark">MVC</span>
					    	<span class="badge badge-pill badge-dark">Visual Studio</span>
						</div>
					  </div>
					  <div class="card-footer">
					    <p class="card-text" id="busca_descricao4">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
					  </div>
					</div>
				</div>

				<div class="col-lg-2 col-md-4 col-sm-4">
					<div class="card text-white mb-3" style="max-width: 18rem;">
					  <div class="card-header" id="busca_titulo5">Título</div>
					  <div class="card-body">
					  	<div class="video" id="busca_video5">
					  		<a href="Exibicao.html">
							  	<video loop muted preload="none" poster="Imagens/EduCast Background.jpg">
							      <source src="Videos/main-background.mp4" type="video/mp4">
							      Your browser does not support the video tag.
							    </video>
						    </a>
						</div>
						<div class="video-info">
							<span class="badge badge-pill badge-light" id="busca_duracao5"><span style="color: #3399ff;">Duração:</span> 3:12</span>
							<span class="badge badge-pill badge-light" id="busca_autor5"><span style="color: #3399ff;">Autor:</span> Carlos Roberto</span>
						</div>
						<div id="busca_tags5">
							<span class="badge badge-pill badge-dark">C#</span>
					    	<span class="badge badge-pill badge-dark">ASP.NET</span>
					    	<span class="badge badge-pill badge-dark">MVC</span>
					    	<span class="badge badge-pill badge-dark">Visual Studio</span>
						</div>
					  </div>
					  <div class="card-footer">
					    <p class="card-text" id="busca_descricao5">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
					  </div>
					</div>
				</div>

				<div class="col-lg-1 col-md-1 col-sm-1"></div>
			</div>

	</section>

	<div class="container">
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12">
				<img id="panda" src="https://vignette.wikia.nocookie.net/camphalfbloodroleplay/images/2/28/Exercise.gif/revision/latest?cb=20161228053139" width="250" height="250">
			</div>
		</div>
	</div>


	<script type="text/javascript">
		var figure = $(".video").hover( hoverVideo, hideVideo );

		function hoverVideo(e) {
		    $('video', this).get(0).play();
		}

		function hideVideo(e) {
		    $('video', this).get(0).pause();
		}

		function fadeInElement(e) {
			e.fadeIn();
		}

		function fadeOutElement(e) {
			e.fadeOut();
		}

		var pag_busca;

		var buscaNext = $('#busca_next').on('click', function() {
			pag_busca += 1;
			rodarAjaxConsulta();
		});

		var buscaPrev = $('#busca_prev').on('click', function() {
			if (pag_busca > 0)
				pag_busca -= 1;

			rodarAjaxConsulta();
		});

		var where_parametro;
		var where_parametro2;

		window.onload = function() {
			where_parametro = getURLParameter('pesquisa');
			where_parametro2 = getURLParameter('disciplina');
			
			if (where_parametro == null) 
				where_parametro = "*";

			if (where_parametro2 == null || where_parametro2 == "Conteúdo" || where_parametro2 == "Todos")
				where_parametro2 = "*"

			$("#txtPesquisado").html("<b style='color: #3399ff'>Filtros:</b> Título = " + where_parametro + " | Disciplina = " + where_parametro2);

		  	pag_busca = 0;
			rodarAjaxConsulta();
		};

		function getURLParameter(name) {
		  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
		}

		function buscar() {
			window.location.replace('Busca.html?pesquisa=' + $('#txtPesquisa').val() + '&disciplina=' + $('.search-panel span#search_concept').text());
			return false;
		}

		function rodarAjaxConsulta() {
			$.ajax({
				type: "POST",
				url: 'Database/consulta_busca.php',
				data: {page: pag_busca, whe: where_parametro, whe2: where_parametro2},
				success: function(result) {
					var vRes = result.split(" ");
					var tVect = vRes.length;
					var whatMatters = [];

					for (var i = tVect - 1; i >= tVect - 40; i--) {
						whatMatters.push(vRes[i]);
					}

					var vez = 1;
					var id = 0;

					$("#busca").fadeOut(function() {
						do {
							$('#busca_titulo' + vez).html(whatMatters[id + 6]);
							$("#busca_duracao" + vez).html("<span style='color: #3399ff;'>Duração:</span> " + whatMatters[id + 4]);
						    $("#busca_video" + vez).html("<video loop muted preload='none' poster='" + whatMatters[id + 3] + "'><source src='" + whatMatters[id + 2] + "' type='video/mp4'>Seu navegador não suporta a tag de vídeo HTML5.</video>");
						    $("#busca_descricao" + vez).html(whatMatters[id + 5]);

						    $("#busca_autor" + vez).html("<span style='color: #3399ff;'>Autor:</span> " + whatMatters[id + 1]);

						    var tag_vect = whatMatters[id].split(",");
						    var tag_str = "";
						    for (var i = 0; i < tag_vect.length; i++) {
						    	tag_str += "<span class='badge badge-pill badge-dark'>" + tag_vect[i] + "</span>";
						    }

						    $("#busca_tags" + vez).html(tag_str);

						    id += 7;
						    vez += 1;
						} while (vez < 6);

						fadeInElement($("#busca"));
					});
				}
			});
		}

		$(document).ready(function(e){
		    $('.search-panel .dropdown-menu').find('a').click(function(e) {
				e.preventDefault();
				var param = $(this).attr("href").replace("#","");
				var concept = $(this).text();
				$('.search-panel span#search_concept').text(concept);
				$('.input-group #search_param').val(param);
			});
		});

	</script>

</body>
<footer>

	<div class="container-fluid bg-light text-dark text-center rodape">
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12">
				<strong>Edu<span style="color: #33cccc;">Cast</span></strong><br>
          		Todos os direito reservados © 2018
			</div>
		</div>
	</div>

</footer>
</html>
